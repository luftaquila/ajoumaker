아주대학교 메이커스페이스
=================

아주대학교 메이커스페이스 전산 관리 시스템 사용설명서  

개발자 연락처
* [Github](https://github.com/luftaquila)  
* [Facebook](http://www.facebook.com/luftaquila)  
* <luftaquila@protonmail.ch>  

## 0. 개요
> 본 시스템은 Google Spreadsheet를 데이터베이스로, Google Apps Script 서비스를 DB 서버로 사용하고 있습니다.  
[데이터베이스](https://docs.google.com/spreadsheets/d/1tubdLyELoYAPi8f3PVeh6jfIbQiQ3au3frIVEbnj20A/edit?usp=sharing) 또는 [스크립트 프로젝트](https://script.google.com/d/MLWrorLkMAWjmLI_SWDNw74rbG83cRkUz/edit) 접근 권한이 필요한 경우, 인증 권한을 새로 등록할 경우 위 연락처로 연락하세요.  
>

## 1. 장비 사용 신청
### 1. 신청
장비 사용자가 장비를 사용하기 전에 먼저 신청서를 작성합니다.  
1. 개인정보 작성  
이름 및 소속, 연락처, 사용 목적을 작성합니다.  
연락처는 010으로 시작하는 11자리 숫자만 입력 가능합니다.
1. 파일 업로드  
`파일 선택` 버튼을 눌러 사용자의 작업 파일을 선택합니다.  
    * 업로드할 파일이 없는 경우 `파일 선택` 버튼 좌측의 체크박스를 해제합니다.  
    * 업로드 가능한 파일 확장자는 .stl 및 .zip입니다.
1. 지불 방식 선택  
사용료 지불 방식을 선택합니다. `후불` 선택 시 DB의 `후불 장부` 시트에 추가 기록됩니다.
1. 사용자 구분  
사용자가 교내구성원인지, 일반인인지 선택합니다. 사용자 유형에 따라 요금 책정 기준이 달라집니다.  
요금 책정 기준은 다음 [부록](https://github.com/luftaquila/ajoumaker#appendix---%EC%9A%94%EA%B8%88-%EC%82%B0%EC%A0%95-%EA%B8%B0%EC%A4%80%ED%91%9C)을 참조하십시오.

1. 장비 분류 선택  
장비 분류를 선택합니다.  
`X7`, `Objet350`, `F370`, `Xfab`, `3D 스캐너` 외 장비는 일반 장비입니다.
1. 장비 선택  
장비 종류를 선택합니다.
1. 사용량 입력  
사용량을 입력합니다.  
장비에 따라 시간 / 시간 및 재료 / 재료 / 면적 등 요금 산출 방식이 다릅니다.
1. 요금 계산  
프로그램이 요금 책정 기준에 따라 자동으로 사용 요금을 계산합니다.  
교내구성원에 한하여 일 1회 요금 할인 해당사항이 있는 경우 할인 체크박스에 체크합니다.
<br>

#### 요금 수동 입력
장비 사용료를 자동 계산이 아닌 수동으로 입력해야 하는 경우, 페이지의 `사용자 구분` 텍스트를 클릭합니다.  
수동 입력 활성화 안내와 함깨 요금 입력 필드가 활성화됩니다.
* 관리자 확인  
입력을 마쳤으면 내용을 점검하고 인증 번호를 입력하여 제출합니다.

#### ✔ 주의사항
* 제출 버튼을 누르고 인증을 완료하면 화면 우측 하단에 파일 업로드 진행률이 표시됩니다.  
녹색으로 `Transmitted` 안내 문구가 나타나기 전까지 업로드 파일이 담긴 USB를 제거하지 마십시오.
* 파일은 아주대학교 메이커스페이스 드롭박스 계정으로 업로드됩니다.
<br>

### 2. 사용 인증
장비 사용 후 출력물 회수 시, 출력물 사진을 포함해 장비 사용을 인증합니다.  
* 서버의 IP 주소는 `210.107.205.215`입니다.  
인증 페이지로 접속하려면 서버 IP를 브라우저 주소창에 입력하거나,  
인증용 태블릿PC의 바탕화면 바로가기를 이용하세요
1. 데이터 로딩이 완료되면 상태 인디케이터가 `Loading...`에서 `Ready.`로 바뀌고 입력 필드가 활성화됩니다.
1. `이름` 입력 필드에 인증할 사용자의 이름을 입력하면, 해당 사용자의 **미인증** 이용 내역이 모두 표시됩니다.
    * 2019년 6월 이전의 사용 내역은 표시되지 않습니다.
1. 인증할 사용 내역을 선택하고 `선택` 버튼을 눌러 진행합니다.
1. `파일 선택`을 누르고 갤러리에서 사진을 선택하거나, 새로 촬영합니다.
1. `제출` 버튼을 눌러 인증을 완료합니다. `정상 인증 되었습니다.` 문구가 알림으로 표시됩니다.
<br>

### 3. 사용 현황
신청 페이지에서 기간별 장비 사용 현황을 차트로 표시합니다. 차트는 매 10분마다 갱신됩니다.  
* `전체 기간` 드롭다운 메뉴를 눌러 월별 기간을 선택할 수 있습니다.
* `통계 접기` 를 누르면 차트가 숨겨집니다. 다시 누르면 나타납니다.

## 2. Dropbox 클라우드
장비가 출력에 실패하여 재출력해야하는 경우에 대비해 작업 파일을 Dropbox에 보관합니다.  
장비 사용 신청을 받는 노트북의 부팅 시 자동 실행 [스크립트](https://github.com/luftaquila/ajoumaker/blob/master/report/Startup.bat)에 의해 14일 이상 경과된 파일은 삭제됩니다.

## 3. 데이터베이스 관리
### **데이터베이스는 반드시 데이터 무결성을 유지해야 합니다.**  
**시트 데이터를 부주의하게 수정하지 마십시오.**  
#### 데이터 무결성 규칙
* **`장비사용`** 시트  
  프로그램을 이용해 신청한 내역이 기록되는 시트입니다.
  * 요금 열을 제외한 어떠한 셀이라도 데이터 문자열에 콤마(,)를 포함해서는 안 됩니다.
  * 어떠한 경우에도 열 순서를 변경할 수 없습니다.  
    반드시 `날짜`, `이름`, `소속 / 학과`, `연락처`, `사용 목적`, `파일명`, `사용 장비`, `사용량`, `구분`, `요금`, `결제`, `담당자`, `사용확인` 순서를 유지하십시오.
  * `날짜`, `사용 장비`, `사용량`, `요금` 열은 특히 수정에 주의해야 합니다.  
  부득이하게 수정해야 할 경우, 띄어쓰기를 포함한 모든 데이터 규격을 반드시 유지하여 주십시오.  
      * 날짜
        * `[yyyy. mm. dd] [오전/오후] [hh시 MM분]`
      * 사용 장비
        * 장비 번호가 있는 경우 : `[장비 이름] [장비 번호]번`  
        *  장비 번호가 없는 경우 : `[장비 이름]`  
      * 사용량
        * 시간 단위 장비 : `[n]시간 [n]분`
        * 시간 및 재료 단위 장비 (X7) : `[n]시간 [n]분 / 카본 : [n]cc`
        * 재료 단위 장비 : `메인 : [n]g` (Xfab), `메인 : [n]g / 서브 : [n]g` (Objet350)
        * 면적 단위 장비 : `[n]mm * [n]mm`
      * 요금
        * `￦[요금]`
        * `[요금]`은 세 자리마다 콤마(,)를 포함합니다.  
        ex) ￦1,234,567

* `이름 검색 도구` 시트  
  초록색 배경의 B2 셀에 검색할 이름을 입력하면, 해당 이름을 가진 사용자의 모든 이용 내역을 표시합니다.
  * B2 셀을 제외한 어떠한 셀도 수정해서는 안 됩니다.

* `마일리지` 시트  
  장비 출력 실패로 인한 마일리지 적립을 기록하는 시트입니다.  
  자동화되어있지 않으므로 자유롭게 편집할 수 있습니다.

* 그 외 모든 시트  
  장비 이름으로 된 모든 시트, `후불 장부` 시트, `수동 입력자 목록` 시트는 100% 자동화된 시트입니다.  
  **어떠한 셀의 내용도 수정할 수 없습니다.**  
  * 내용을 수정해야 할 경우, 해당 내용을 `장비사용` 시트에서 찾아 데이터 규격에 맞게 수정하십시오.

## 4. 사용 인증 서버 관리
* 메이커스페이스 프론트 데스크의 데스크탑 컴퓨터가 서버로 동작하는 페이지입니다.    
인증 서버를 유지하기 위해 업무 시간 중 해당 데스크탑의 전원을 항상 유지하십시오.
* 서버는 데스크탑 부팅 시 자동으로 실행됩니다.
* 서버 동작 중에는 콘솔 명령 프롬프트 창이 실행됩니다. 닫으면 서버가 종료되니 열린 상태로 유지하십시오.  
실수로 닫았을 경우, 아래 서버 설치 가이드를 참조하여 재실행하세요.
* 서버 컴퓨터의 현재 IP 주소는 `210.107.205.215`입니다.  

## Appendix - 인증 서버 설치 가이드
인증 서버는 *Node.js* 로 작성되었습니다. 서버를 실행하기 위해 최신 *Node.js* 가 필요합니다.  
1. [Node.js 다운로드](https://nodejs.org/ko/download/) 페이지에서 LTS 버전 Windows Installer를 다운해 설치합니다.
1. 컴퓨터를 재부팅하고, `Win + R` 키를 눌러 `cmd`를 입력합니다. 콘솔 명령 프롬프트에 `node`를 입력하고 엔터를 누르십시오.
    * `Welcome to Node.js v12.5.0.` 이 표시되면 다음 단계로 진행합니다. 버전은 다를 수 있습니다.
    * `'node'은(는) 내부 또는 외부 명령, 실행할 수 있는 프로그램, 또는 배치 파일이 아닙니다.` 가 출력되면 환경 변수에 Node.js를 추가합니다.
      1. `파일 탐색기`에서 `내 컴퓨터`를 우클릭하고 `속성`에 들어갑니다.
      1. 화면 좌측의 `고급 시스템 설정`을 클릭합니다. `환경 변수`를 누르고 아래 `시스템 변수`에서 `Path` 항목을 찾아 `편집`을 누릅니다.
      1. `추가`를 누르고 Node.js 설치 폴더의 경로를 입력한 후 확인을 눌러 빠져나오고, 재부팅하세요.  
      일반적으로 Node.js의 설치 경로는 `C:\Program Files\nodejs\` 입니다.
      1. 재부팅 후에도 `node` 명령어를 인식하지 못하면 재설치합니다.
1. 인증 서버 [server.js](https://github.com/luftaquila/ajoumaker/blob/master/report/server.js)를 다운로드해 컴퓨터에 저장합니다.
1. 명령 프롬프트에서 `cd` 명령어를 이용해 server.js 파일을 저장한 위치로 이동합니다.
1. `node server` 명령어를 이용해 서버를 실행합니다.

* server.js 파일을 `D:\메이커스페이스 서버` 경로에 저장한 경우, 아래 배치 파일을 이용해 손쉽게 서버를 실행할 수 있습니다.
```Batchfile
D:
cd "메이커스페이스 서버"
node server
```
배치 파일을 시작 프로그램에 등록하면 부팅 시 자동으로 실행됩니다.  
바탕 화면 바로가기로 만들어 두면 실수로 닫았을 때 편리하게 재실행할 수 있습니다.

## Appendix - 요금 산정 기준표
| <center></center> | <center>교내구성원</center> | <center>일반인</center> |
|:--------:|:--------:|:--------:|
| 큐비콘 | ￦1,500 / hr<br>일 1회 6시간 이내 무료 | ￦2,000 / hr |
| 신도 | ￦1,500 / hr<br>일 1회 6시간 이내 무료 | ￦2,000 / hr |
| Zortrax | ￦1,500 / hr<br>일 1회 2시간 이내 무료 | ￦2,000 / hr |
| Onyx One | ￦2,000 / hr<br>일 1회 2시간 이내 무료 | ￦4,000 / hr |
| Freeform | ￦4,000 / hr<br>일 1회 1시간 이내 무료 | ￦6,000 / hr |
| 레이저커터 | ￦1,500 / hr | ￦2,500 / hr |
| 플로터 | ￦0.5 / ㎠ | ￦0.5 / ㎠ |
| 커팅플로터 | ￦1,500 / hr | ￦2,500 / hr |
| UV 프린터 | ￦8 / ㎠ | ￦8 / ㎠ |
| X7 | ￦3,500 / hr<br>주 재료 ￦5,000 / cc | ￦6,500 / hr<br>주 재료 ￦9,000 / cc |
| Objet350 | 주 재료 ￦400 / g<br> 보조 재료 ￦150 / g | 주 재료 ￦700 / g<br> 보조 재료 ￦250 / g |
| F370 | ￦14,000 / hr | ￦20,000 / hr |
| Xfab | 주 재료 ￦400 / g | 주 재료 ￦600 / g |
| 3D 스캐너 | ￦6,000 / hr | ￦12,000 / hr |
